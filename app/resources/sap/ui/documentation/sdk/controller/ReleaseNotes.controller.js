/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2017 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","sap/ui/documentation/sdk/controller/BaseController","sap/ui/model/json/JSONModel","sap/ui/documentation/library"],function(q,B,J,l){"use strict";var n="neo-app.json",s="resources/sap-ui-version.json";return B.extend("sap.ui.documentation.sdk.controller.ReleaseNotes",{onInit:function(){this._oView=this.getView();this._requestResources();this._resourceAvailabilityHandler();this._oModel=new J();this._oVersionModel=new J();this._oView.setModel(this._oModel);this._oView.setModel(this._oVersionModel,"select");l._loadAllLibInfo("","_getLibraryInfoAndReleaseNotes","",this._processLibInfo.bind(this));l._getAppInfo(this._processAppInfo.bind(this));},_processAppInfo:function(a){var v,m,M,V,o;if(!(a)){return;}v=q.sap.Version(a.version);m=v.getMajor();M=v.getMinor();if(v.getSuffix()!==""){if(M%2!==0){M=(M+1);}}V=m+"."+M;o={items:[]};while(M>=28){V=m+"."+M;o.items.push({key:V,value:V});M=M-2;}this._oVersionModel.setData(o);},_processLibInfo:function(L,o){var r,R=[],c=L.length,p,i;p=function(v,V){r+=V.notes.length;L[i].versions.push({version:v,notes:V.notes});L[i].versions.sort(function(a,b){return q.sap.Version(b.version).compareTo(a.version);});};for(i=0;i<c;i++){L[i]=o[L[i]];L[i].versions=[];if(L[i].relnotes){r=0;q.each(L[i].relnotes,p);if(r>0){R.push(L[i]);}}}this._oModel.setData({libs:R});this._hideBusyIndicator();},_requestResources:function(){this._oNeoAppJsonPromise=q.ajax(n);this._oSapUiVersionJsonPromise=q.ajax(s);},_resourceAvailabilityHandler:function(){q.when(this._oNeoAppJsonPromise,this._oSapUiVersionJsonPromise).then(function(N,S){this._oNeoAppVersions=N[0].routes;this._sSapUiVersion=S[0].version;this._oView.byId("VersionSelect").setVisible(true);}.bind(this),function(){q.sap.log.warning("No neo-app.json was detected");});},_compareUI5Versions:function(v,V){var o=q.sap.Version(v),a=q.sap.Version(V);return(o.getMajor()+"."+o.getMinor())===(a.getMajor()+"."+a.getMinor());},_updateLastReleasedVersion:function(v){if(this._compareUI5Versions(v,this._sSapUiVersion)&&parseFloat(this._sLastReleasedVersion)>parseFloat(this._sSapUiVersion)){this._sLastReleasedVersion=this._sSapUiVersion;}},_getLastVersionFromNeoAppJson:function(S){var L=this._oNeoAppVersions?this._oNeoAppVersions.length:0,v,i;for(i=0;i<L;i++){v=this._oNeoAppVersions[i].target.version;if(this._compareUI5Versions(v,S)){return v;}}},handleVersionChange:function(e){var i=e.getParameter("selectedItem"),S=i.getKey(),v;this._sLastReleasedVersion=this._getLastVersionFromNeoAppJson(S);this._updateLastReleasedVersion(S);v=this._sLastReleasedVersion?this._sLastReleasedVersion:S;this._showBusyIndicator();l._loadAllLibInfo("","_getLibraryInfoAndReleaseNotes",v,this._processLibInfo.bind(this));},_showBusyIndicator:function(){this.getView().byId("releaseNotesObjectPage").setBusy(true);},_hideBusyIndicator:function(){this.getView().byId("releaseNotesObjectPage").setBusy(false);}});});
